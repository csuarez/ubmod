===============================================================================
UBMoD - Installation
===============================================================================

This document will attempt to ouline a basic install of UBMoD. As UBMoD is
still actively being developed these instructions may be incomplete and are
subject to change in future releases. Any feedback is welcome.

The latest version of this document can be found online at:

    http://ubmod.sourceforge.net/install.html

This installation document assumes you are running a Linux based system and
already have Apache with mod_rewrite and MySQL version 5 or greater installed
and running. UBMoD requires PHP version 5.3 or greater and Perl 5.8 or
greater. PHP must be built with GD and PDO support. Perl requires the
following modules: DBI, DBD::mysql, Config::Tiny and DateTime.

These can be installed on Red Hat based systems with the following command:

    # yum install httpd mysql-server mysql php php-mysql php-pdo php-gd perl \
                  perl-DBI perl-DBD-MySQL perl-Config-Tiny perl-DateTime

and on Debain debian based systems with this command:

    # apt-get install apache2 mysql-server mysql-client libapache2-mod-php5 \
                      php5 php5-mysql php5-gd perl libdbi-perl \
                      libdbd-mysql-perl libconfig-tiny-perl libdatetime-perl

Download UBMoD

* Download the latest pre-built release (ubmod-x.x.x.tar.gz)

    $ tar -xvzf ubmod-x.x.x.tar.gz
    $ cd ubmod-x.x.x

* Set up the MySQL database

    mysql> create database ubmod;
    mysql> grant all on ubmod.* to ubmoduser@localhost identified by 'password';
    mysql> quit;

    $ mysql -u ubmoduser -p ubmod < ./ddl/ubmod.sql

* Create the UBMoD config files

    - Create the files portal/config/settings.ini and
      shredder/config/settings.ini with your site specific settings. An
      example can be found in the docs directory of the UBMoD distribution.
      These files both contain the same information. Two files are needed so
      that the portal and shredder can be moved and used separately if
      necessary.

    [database]
    host = localhost
    dbname = ubmod
    user = ubmoduser
    password = password

* Load in accounting log data from TORQUE

    $ ubmod-shredder -v -s --format pbs -H your.host.org -d /var/spool/pbs/server_priv/accounting

* Aggregate accounting log data

    $ ubmod-shredder -v -u

* Set up the web application

    - The UBMoD portal is packaged as a PHP application.
      * Note that this is a basic example of setting up Apache for use with
      UBMoD for demo purposes only and not intended for production use.

* Copy the following into your Apache configuration file.
  Replace /path/to/ubmod with the appropriate path.

    Listen 8080
    <VirtualHost *:8080>
        DocumentRoot /path/to/ubmod/html
        <Directory /path/to/ubmod/html>
            RewriteEngine on
            RewriteCond $1 !^index\.php/
            RewriteRule ^api/rest/(.*)$ /api/rest/index.php/$1 [L]
            RewriteCond $1 !^api/rest/
            RewriteCond $1 !^(favicon\.ico|robots\.txt)$
            RewriteCond $1 !^(css|images|js|resources)/
            RewriteCond $1 !^index\.php/
            RewriteRule ^(.*)$ /index.php/$1 [L]
        </Directory>
    </VirtualHost>

* Point your browser to http://localhost:8080/
